# 链接

- [1. 栈](#1-栈)
- [2. ELF](#2-elf)
- [3. 静态链接](#3-静态链接)

一个翻译单元由源文件和直接或间接包含的所有标头组成

## 1. 栈

缓冲区溢出攻击：外部向 char 数组写数据时，溢出并覆盖函数返回地址，可以执行任意代码

对抗缓冲区溢出攻击：

- 栈随机化：程序一开始会在栈上分配随机大小的空间，是标准行为。该防御不是完全安全的。
- 栈破坏检测：在函数中有 char 局部数组时，保存函数返回地址，并在调用后比较
- 限制可执行代码区域：栈被标记为可读可写不可执行

## 2. ELF

ELF 分类

- 可重定位文件 relocatable file
- 可执行文件 executable file
- 共享目标文件 shared object file
- 核心转储文件 core dump file

ELF 构成

- ELF 头 ELF header
- .text 代码段
- .data 数据段
- .rodata 只读数据
- .bss bss 段，存未初始化的静态变量，在文件中不占空间
- .symtab 符号表
- .rel.text 重定位到 .text
- .rel.data 重定位到 .data
- .debug 调试符号表，需要 -g 编译
- .line 行号，需要 -g 编译
- .strtab 字符串表

符号

- 本模块定义的全局符号，比如非静态函数和非静态全局变量
- 被本模块引用的全局符号（外部符号）
- 局部符号，比如静态函数和静态全局变量

.symtab 节

```cpp
typedef struct { 
    int name; // 字符串索引
    char type: 4, // 函数还是数据
         binding: 4; // 局部还是全局
    char reserved;
    short section; // 到节头表的索引
    long value; // 目标地址
    long size; // 目标大小
} Elf64_Syrnbol;
```

## 3. 静态链接

重名符号：

1. 不允许多个重名的强符号
2. 优先强符号
3. 弱符号里选择任意一个

静态库：多个目标文件的打包

- `ar rcs xxx.a xxx.o xxx.o ...`
- `gcc -static -o main main.o ./xxx.a`

libc.a 提供标准 IO、字符串等操作

libm.a 提供浮点数学函数

静态库以存档 archive 的文件格式保存，后缀 .a
